# キセカLINEボット

これは「キセカ」という単語に反応して、元気な妹風の返事をしてくれるシンプルなLINEボットです。

## プロジェクト概要

- **言語**: Node.js
- **フレームワーク**: Express
- **LINE SDK**: @line/bot-sdk

## デプロイまでの道のり

このボットを24時間稼働させるため、クラウドサービスへのデプロイを行いました。

1.  **クラウドサービスの選定**
    - 無料で利用でき、GitHubからの自動デプロイに対応している **Render** を選択しました。

2.  **デプロイの試行とエラーハンドリング**
    - **初回デプロイ失敗**:
        - **原因**: `package.json`内の`scripts` -> `test`の値に含まれるダブルクォーテーションがエスケープされておらず、JSONの構文エラー（`EJSONPARSE`）が発生。
        - **ログ**: `npm error JSON.parse Expected ',' or '}' after property value...`
    - **修正と再デプロイ失敗**:
        - **原因**: 構文エラーの修正時に、`"test"`というキー名の最初のダブルクォーテーションまで誤って削除してしまい、再度JSON構文エラーが発生。
        - **ログ**: `npm error JSON.parse Expected double-quoted property name...`
    - **最終的な修正と成功**:
        - `package.json`の構文を正しく修正し、GitHubにプッシュ。
        - Render側で自動デプロイが実行され、ビルドとデプロイに成功しました。

3.  **最終設定**
    - Renderで発行されたサービスURL（`https://kiseka-line.onrender.com`）の末尾に`/webhook`を付与。
    - 上記URLをLINE DevelopersコンソールのWebhook URLに設定し、全工程が完了しました。

4.  **AI機能の統合**
    - Google Gemini APIを導入し、ボットの応答をAIが生成するように変更しました。
    - `package.json`に`@google/generative-ai`パッケージを追加。
    - `index.js`を修正し、Gemini APIを呼び出すロジックと、キセカのペルソナを定義したプロンプトを追加。
    - Renderの環境変数に`GEMINI_API_KEY`を設定する必要がありました。

5.  **AIモデル呼び出しエラーの修正**
    - デプロイ後、AIモデルの呼び出しで`404 Not Found`エラーが発生。
    - **原因**: `gemini-pro`モデルがAPIバージョン`v1beta`で利用できない、または見つからないため。
    - **修正**: `index.js`内のモデル名を`gemini-1.5-flash`に変更。

6.  **キセカのふるまい設定の追加**
    - ユーザーから提供された詳細なペルソナ設定を`index.js`内のAIプロンプトに反映させました。これにより、キセカの応答がより個性的になりました。

7.  **応答速度に関する考察**
    - LINEからの返信に時間がかかる場合があることが確認されました。
    - **主な原因**:
        - **AIモデルの応答時間**: AIが応答を生成するのに時間がかかるため。
        - **Renderの無料プランの特性（コールドスタート）**: 一定時間アクセスがないとサービスが一時停止し、次のリクエスト時に起動に時間がかかるため（最大50秒以上の遅延）。
    - **改善策**: Renderの有料プランへのアップグレードが最も効果的です。